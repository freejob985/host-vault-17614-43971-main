<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        .icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }
        
        .icon svg {
            width: 40px;
            height: 40px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .status {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            animation: progress 3s ease-in-out infinite;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
        
        .info {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: right;
        }
        
        .info-item {
            margin-bottom: 10px;
            color: #555;
            font-size: 14px;
        }
        
        .info-item strong {
            color: #333;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .error {
            color: #e74c3c;
            background: #fee;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .console-log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        .console-log.show {
            display: block;
        }
        
        .log-line {
            margin: 5px 0;
            padding: 2px 0;
        }
        
        .log-success { color: #4caf50; }
        .log-error { color: #f44336; }
        .log-warning { color: #ff9800; }
        .log-info { color: #2196f3; }
    </style>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&family=Noto+Kufi+Arabic:wght@100..900&family=Noto+Sans+Arabic:wght@100..900&family=Tajawal:wght@200;300;400;500;700;800;900&display=swap" rel="stylesheet">

<style>
    
* {
  font-family: "Cairo", sans-serif;
  font-optical-sizing: auto;
  font-weight: 400;
  font-style: normal;
  font-variation-settings:
    "slnt" 0;
}
</style>
</head>
<body>
    <div class="container">
        <div class="icon">
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 6v6l4 2"></path>
            </svg>
        </div>
        
        <h1>Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
        <p class="status" id="status">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        
        <div class="info" id="info"></div>
        <div class="console-log" id="console"></div>
    </div>

    <script>
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† URL
        const urlParams = new URLSearchParams(window.location.search);
        const targetUrl = urlParams.get('url');
        const username = urlParams.get('username');
        const password = urlParams.get('password');
        const autoSubmit = urlParams.get('auto_submit') === 'true';
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„Ø´Ø§Ù…Ù„
        const formId = urlParams.get('form_id') || 'login_form';
        const usernameField = urlParams.get('username_field') || 'user';
        const passwordField = urlParams.get('password_field') || 'pass';
        const submitButton = urlParams.get('submit_button') || 'login_submit';

        const statusEl = document.getElementById('status');
        const infoEl = document.getElementById('info');
        const consoleEl = document.getElementById('console');

        function log(message, type = 'info') {
            const logLine = document.createElement('div');
            logLine.className = `log-line log-${type}`;
            logLine.textContent = `[${new Date().toLocaleTimeString('ar')}] ${message}`;
            consoleEl.appendChild(logLine);
            consoleEl.scrollTop = consoleEl.scrollHeight;
            consoleEl.classList.add('show');
        }

        function updateStatus(message) {
            statusEl.textContent = message;
            log(message, 'info');
        }

        function showInfo() {
            if (!targetUrl || !username || !password) {
                infoEl.innerHTML = `
                    <div class="error">
                        <strong>âš ï¸ Ø®Ø·Ø£: Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©</strong>
                        <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·</p>
                    </div>
                `;
                log('Ø®Ø·Ø£: Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© ÙÙŠ URL', 'error');
                return false;
            }

            infoEl.innerHTML = `
                <div class="info-item"><strong>ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${targetUrl}</div>
                <div class="info-item"><strong>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${username}</div>
                <div class="info-item"><strong>ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</strong> ${'â€¢'.repeat(password.length)}</div>
                <div class="info-item"><strong>ğŸ“¤ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:</strong> ${autoSubmit ? 'Ù†Ø¹Ù… âœ“' : 'Ù„Ø§'}</div>
            `;
            return true;
        }

        function createAutoFillScript() {
            return `
                (function() {
                    const username = "${username.replace(/"/g, '\\"')}";
                    const password = "${password.replace(/"/g, '\\"')}";
                    const autoSubmit = ${autoSubmit};
                    const formId = "${formId}";
                    const usernameField = "${usernameField}";
                    const passwordField = "${passwordField}";
                    const submitButton = "${submitButton}";

                    console.log('ğŸ” Auto Login Helper v3.0: Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©');

                    // ===== Ù…ØµÙÙˆÙØ© Ø´Ø§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø­Ù‚ÙˆÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… =====
                    const USERNAME_PATTERNS = {
                        // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ (name attribute)
                        names: [
                            'user', 'username', 'userName', 'user_name', 'user-name',
                            'login', 'loginname', 'login_name', 'login-name',
                            'email', 'e-mail', 'mail', 'emailaddress', 'email_address',
                            'account', 'accountname', 'account_name',
                            'userid', 'user_id', 'id',
                            'loginid', 'login_id',
                            'handle', 'alias',
                            // cPanel specific
                            'user', 'cpanel_user',
                            // Plesk specific
                            'login_name', 'loginName',
                            // DirectAdmin specific
                            'username', 'referer',
                            // WordPress specific
                            'log', 'user_login',
                            // Common variations
                            'identification', 'credential',
                            // Custom field names from URL
                            usernameField
                        ],
                        
                        // Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø­Ù‚ÙˆÙ„ (id attribute)
                        ids: [
                            'user', 'username', 'userName', 'user_name', 'user-name',
                            'login', 'loginname', 'login_name', 'login-name',
                            'email', 'e-mail', 'mail', 'emailaddress',
                            'account', 'accountname',
                            'userid', 'user_id', 'id',
                            'input-user', 'input-username', 'input-login',
                            'txt-user', 'txt-username', 'txt-login',
                            'field-user', 'field-username',
                            // cPanel
                            'user', 'login_user',
                            // WordPress
                            'user_login', 'log',
                            // Generic
                            'signin-username', 'signin-email',
                            // Custom field names from URL
                            usernameField
                        ],
                        
                        // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ (type attribute)
                        types: ['text', 'email', 'tel'],
                        
                        // Ù†ØµÙˆØµ placeholder
                        placeholders: [
                            'username', 'user name', 'enter username', 'your username',
                            'email', 'e-mail', 'enter email', 'your email',
                            'login', 'enter login', 'account',
                            'usuario', 'utilisateur', // Spanish, French
                            'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ' // Arabic
                        ],
                        
                        // Ù†ØµÙˆØµ autocomplete
                        autocomplete: ['username', 'email', 'login']
                    };

                    // ===== Ù…ØµÙÙˆÙØ© Ø´Ø§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± =====
                    const PASSWORD_PATTERNS = {
                        // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„
                        names: [
                            'pass', 'password', 'passwd', 'pwd',
                            'pass_word', 'pass-word', 'password1',
                            'user_pass', 'user-pass', 'userpass', 'userpassword',
                            'login_pass', 'login-pass', 'loginpass', 'loginpassword',
                            'account_pass', 'account-pass',
                            'secret', 'pin', 'code',
                            // cPanel
                            'pass', 'cpanel_pass',
                            // Plesk
                            'passwd', 'password',
                            // WordPress
                            'pwd', 'user_pass',
                            // Common
                            'credential_password', 'auth_password',
                            // Custom field names from URL
                            passwordField
                        ],
                        
                        // Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø­Ù‚ÙˆÙ„
                        ids: [
                            'pass', 'password', 'passwd', 'pwd',
                            'pass_word', 'pass-word', 'password1',
                            'user_pass', 'user-pass', 'userpass',
                            'login_pass', 'login-pass', 'loginpass',
                            'input-pass', 'input-password', 'input-passwd',
                            'txt-pass', 'txt-password',
                            'field-pass', 'field-password',
                            // WordPress
                            'user_pass', 'pwd',
                            // Generic
                            'signin-password', 'login-password',
                            // Custom field names from URL
                            passwordField
                        ],
                        
                        // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
                        types: ['password'],
                        
                        // Ù†ØµÙˆØµ placeholder
                        placeholders: [
                            'password', 'pass word', 'enter password', 'your password',
                            'passwd', 'pwd', 'secret', 'pin',
                            'contraseÃ±a', 'mot de passe', // Spanish, French
                            'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±' // Arabic
                        ],
                        
                        // Ù†ØµÙˆØµ autocomplete
                        autocomplete: ['current-password', 'password']
                    };

                    // ===== Ù…ØµÙÙˆÙØ© Ø´Ø§Ù…Ù„Ø© Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ =====
                    const SUBMIT_PATTERNS = {
                        // By type
                        types: ['submit', 'button'],
                        
                        // By name
                        names: [
                            'login', 'signin', 'submit', 'send', 'enter',
                            'log_in', 'sign_in', 'log-in', 'sign-in',
                            'btn_login', 'btn_signin', 'btn_submit',
                            // Custom button names from URL
                            submitButton
                        ],
                        
                        // By id
                        ids: [
                            'login', 'signin', 'submit', 'send', 'enter',
                            'login_submit', 'submit_btn', 'btn_login',
                            'loginButton', 'signinButton', 'submitButton',
                            'wp-submit', // WordPress
                            // Custom button names from URL
                            submitButton
                        ],
                        
                        // By class
                        classes: [
                            'login-btn', 'submit-btn', 'btn-login', 'btn-submit',
                            'btn-primary', 'btn-success', 'btn-submit',
                            'login-button', 'submit-button'
                        ],
                        
                        // Generic selectors
                        generic: [
                            'button[type="submit"]',
                            'input[type="submit"]',
                            'form button:not([type="button"]):not([type="reset"])',
                            '.login-btn button',
                            '.submit-btn button'
                        ]
                    };

                    function findElement(selectors) {
                        for (let selector of selectors) {
                            try {
                                const el = document.querySelector(selector);
                                if (el) {
                                    console.log('âœ“ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰:', selector);
                                    return el;
                                }
                            } catch(e) {}
                        }
                        return null;
                    }

                    function fillInput(input, value) {
                        if (!input) return false;
                        
                        input.focus();
                        input.value = value;
                        
                        // Trigger events
                        ['focus', 'input', 'change', 'blur'].forEach(eventType => {
                            const event = new Event(eventType, { bubbles: true });
                            input.dispatchEvent(event);
                        });
                        
                        console.log('âœ“ ØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚Ù„:', input.name || input.id);
                        return true;
                    }

                    function attemptAutoFill() {
                        const usernameField = findElement(USERNAME_SELECTORS);
                        const passwordField = findElement(PASSWORD_SELECTORS);

                        if (!usernameField || !passwordField) {
                            console.log('âš  Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙˆÙ„ØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰...');
                            return false;
                        }

                        fillInput(usernameField, username);
                        fillInput(passwordField, password);

                        if (autoSubmit) {
                            setTimeout(() => {
                                const submitBtn = findElement(SUBMIT_SELECTORS);
                                if (submitBtn) {
                                    console.log('ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...');
                                    submitBtn.click();
                                } else {
                                    console.log('â Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter...');
                                    const enterEvent = new KeyboardEvent('keypress', {
                                        key: 'Enter',
                                        code: 'Enter',
                                        keyCode: 13,
                                        which: 13,
                                        bubbles: true
                                    });
                                    passwordField.dispatchEvent(enterEvent);
                                }
                            }, 500);
                        }

                        console.log('âœ… ØªÙ…Øª Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                        return true;
                    }

                    // Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
                    let attempts = 0;
                    const maxAttempts = 5;
                    
                    function tryFill() {
                        attempts++;
                        console.log(\`Ù…Ø­Ø§ÙˆÙ„Ø© \${attempts}/\${maxAttempts}\`);
                        
                        if (attemptAutoFill()) {
                            return;
                        }
                        
                        if (attempts < maxAttempts) {
                            setTimeout(tryFill, 500);
                        } else {
                            console.log('âš  ÙØ´Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª');
                        }
                    }

                    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø¨Ø¦Ø©
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', tryFill);
                    } else {
                        setTimeout(tryFill, 100);
                    }

                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„
                    window.addEventListener('load', () => {
                        setTimeout(() => {
                            const passField = document.querySelector('input[type="password"]');
                            if (passField && !passField.value) {
                                console.log('Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙÙŠØ©...');
                                attemptAutoFill();
                            }
                        }, 500);
                    });
                })();
            `;
        }

        async function openAndFill() {
            if (!showInfo()) {
                return;
            }

            updateStatus('Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹...');
            log('ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ' + targetUrl, 'info');

            // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const newWindow = window.open(targetUrl, '_blank');

            if (!newWindow) {
                statusEl.innerHTML = `
                    <div class="error">
                        <strong>âš ï¸ Ø®Ø·Ø£: ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©</strong>
                        <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙÙŠ Ù…ØªØµÙØ­Ùƒ</p>
                        <a href="${targetUrl}" target="_blank" class="btn">ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹</a>
                    </div>
                `;
                log('Ø®Ø·Ø£: ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©', 'error');
                return;
            }

            updateStatus('ØªÙ… ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹! Ø¬Ø§Ø±ÙŠ Ø­Ù‚Ù† Ø§Ù„ÙƒÙˆØ¯...');
            log('ØªÙ… ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©', 'success');

            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ù‚Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
            let injectionAttempted = false;
            
            function attemptInjection() {
                if (injectionAttempted) return;
                injectionAttempted = true;
                
                try {
                    // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø­Ù‚Ù† Ù…Ø¨Ø§Ø´Ø±
                    if (newWindow.document && newWindow.document.head) {
                        const script = newWindow.document.createElement('script');
                        script.textContent = createAutoFillScript();
                        newWindow.document.head.appendChild(script);
                        log('âœ… ØªÙ… Ø­Ù‚Ù† Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        updateStatus('âœ… ØªÙ… Ø­Ù‚Ù† Ø§Ù„ÙƒÙˆØ¯! Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹');
                        
                        setTimeout(() => {
                            window.close();
                        }, 3000);
                        return true;
                    }
                } catch(e) {
                    log('ÙØ´Ù„ Ø§Ù„Ø­Ù‚Ù† Ø§Ù„Ù…Ø¨Ø§Ø´Ø±: ' + e.message, 'warning');
                }
                
                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ø³ØªØ®Ø¯Ø§Ù… postMessage
                try {
                    const autoFillData = {
                        type: 'AUTO_FILL_DATA',
                        username: username,
                        password: password,
                        autoSubmit: autoSubmit,
                        formId: formId,
                        usernameField: usernameField,
                        passwordField: passwordField,
                        submitButton: submitButton
                    };
                    
                    newWindow.postMessage(autoFillData, '*');
                    log('ğŸ“¤ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± postMessage', 'info');
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
                    window.addEventListener('message', function(event) {
                        if (event.data.type === 'AUTO_FILL_SUCCESS') {
                            log('âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ø§Ø¬Ø­Ø©', 'success');
                            updateStatus('âœ… ØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
                            setTimeout(() => window.close(), 2000);
                        } else if (event.data.type === 'AUTO_FILL_ERROR') {
                            log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø¨Ø¦Ø©: ' + event.data.error, 'error');
                        }
                    });
                    
                    updateStatus('ğŸ“¤ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø§Ù†ØªØ¸Ø± Ø§Ù„ØªØ¹Ø¨Ø¦Ø©...');
                    setTimeout(() => {
                        if (!injectionAttempted) {
                            showFallbackInfo();
                        }
                    }, 5000);
                    
                } catch(e) {
                    log('ÙØ´Ù„ postMessage: ' + e.message, 'warning');
                    showFallbackInfo();
                }
            }
            
            function showFallbackInfo() {
                statusEl.innerHTML = `
                    <div class="error">
                        <strong>âš ï¸ Ù„Ù… ÙŠØªÙ… Ø­Ù‚Ù† Ø§Ù„ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</strong>
                        <p>ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª Tampermonkey ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù…Ø±ÙÙ‚</p>
                        <p><strong>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</strong></p>
                        <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> <code>${username}</code> 
                               <button onclick="navigator.clipboard.writeText('${username}')" style="margin-right: 10px; padding: 5px 10px; cursor: pointer; background: #667eea; color: white; border: none; border-radius: 4px;">Ù†Ø³Ø®</button>
                            </p>
                            <p><strong>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</strong> <code>${'â€¢'.repeat(password.length)}</code> 
                               <button onclick="navigator.clipboard.writeText('${password}')" style="margin-right: 10px; padding: 5px 10px; cursor: pointer; background: #667eea; color: white; border: none; border-radius: 4px;">Ù†Ø³Ø®</button>
                               <button onclick="alert('${password}')" style="margin-right: 10px; padding: 5px 10px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 4px;">Ø¹Ø±Ø¶</button>
                            </p>
                        </div>
                        <p><strong>Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:</strong></p>
                        <p><code>${targetUrl}?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}&auto_submit=${autoSubmit}</code></p>
                    </div>
                `;
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­Ù‚Ù† Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            if (newWindow.document.readyState === 'loading') {
                newWindow.addEventListener('load', attemptInjection);
            } else {
                attemptInjection();
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ±
            setTimeout(attemptInjection, 1000);
        }

        // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', () => {
            setTimeout(openAndFill, 1000);
        });
    </script>
</body>
</html>

